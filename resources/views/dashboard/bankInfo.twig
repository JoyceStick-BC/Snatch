{% extends 'templates/dashboard.twig' %}
{% block content %}
	<h1>Bank Account Information:</h1>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<p>In order to receive payments, please fill out the form below. </p>
	{% if has_account %}
		<p><b>NOTE: </b>You already have a bank account registered with Trimm. If you fill out this form, you will overwrite that account.</p>
	{% endif %}
	<form action="{{ path_for('account.postBankInfo') }}" method="post" id="bank-form">
		<h1>Personal Information</h1>
		<p>First Name</p>
		<input type="text" id="first-name" name="first-name" alt="First Name">
		<p>Last Name</p>
		<input type="text" id="last-name" name="last-name" alt="Last Name">
		<p>Address Line 1</p>
		<input type="text" id="address-line-1" name="address-line-1" alt="Address Line 1">
		<p>City</p>
		<input type="text" id="address-city" name="address-city" alt="City">
		<p>State</p>
		<select name="state">
			<option value="AL">Alabama</option>
			<option value="AK">Alaska</option>
			<option value="AZ">Arizona</option>
			<option value="AR">Arkansas</option>
			<option value="CA">California</option>
			<option value="CO">Colorado</option>
			<option value="CT">Connecticut</option>
			<option value="DE">Delaware</option>
			<option value="DC">District Of Columbia</option>
			<option value="FL">Florida</option>
			<option value="GA">Georgia</option>
			<option value="HI">Hawaii</option>
			<option value="ID">Idaho</option>
			<option value="IL">Illinois</option>
			<option value="IN">Indiana</option>
			<option value="IA">Iowa</option>
			<option value="KS">Kansas</option>
			<option value="KY">Kentucky</option>
			<option value="LA">Louisiana</option>
			<option value="ME">Maine</option>
			<option value="MD">Maryland</option>
			<option value="MA">Massachusetts</option>
			<option value="MI">Michigan</option>
			<option value="MN">Minnesota</option>
			<option value="MS">Mississippi</option>
			<option value="MO">Missouri</option>
			<option value="MT">Montana</option>
			<option value="NE">Nebraska</option>
			<option value="NV">Nevada</option>
			<option value="NH">New Hampshire</option>
			<option value="NJ">New Jersey</option>
			<option value="NM">New Mexico</option>
			<option value="NY">New York</option>
			<option value="NC">North Carolina</option>
			<option value="ND">North Dakota</option>
			<option value="OH">Ohio</option>
			<option value="OK">Oklahoma</option>
			<option value="OR">Oregon</option>
			<option value="PA">Pennsylvania</option>
			<option value="RI">Rhode Island</option>
			<option value="SC">South Carolina</option>
			<option value="SD">South Dakota</option>
			<option value="TN">Tennessee</option>
			<option value="TX">Texas</option>
			<option value="UT">Utah</option>
			<option value="VT">Vermont</option>
			<option value="VA">Virginia</option>
			<option value="WA">Washington</option>
			<option value="WV">West Virginia</option>
			<option value="WI">Wisconsin</option>
			<option value="WY">Wyoming</option>
		</select>
		<p>Postal Code</p>
		<input type="text" name="address-postal-code" alt="Postal Code">
		<p>Country</p>
		<select id="country" name="country">
	        <option value="US">United States</option>
	        <option value="CA">Canada</option>
	        <option value="GB">United Kingdom</option>
	        <option value="DE">Germany</option>
	        <option value="FR">France</option>
	        <option value="ES">Spain</option>
		<select>
		<p>Date of Birth</p>
		<input type="date" name="birthday" alt="Date of Birth">
		<p>Individual/Company</p>
		<select id="legal-entity" name="legal-entity">
      		<option value="individual">Individual</option>
        	<option value="company">Company</option>
      	</select>
      	<p>Last 4 of SSN</p>
      	<input type="text" name="ssn_last_4" alt="Social Security Number Last 4">
      	{{ csrf.field | raw }}
      	<input type="text" name="bank-token" id="bank-token" style="display:none">
    </form>
    <p id="personal-info-errors"></p>
	<h1>Bank Account Information</h1>
	<select id="country">
        <option value="US">United States</option>
        <option value="CA">Canada</option>
        <option value="GB">United Kingdom</option>
        <option value="DE">Germany</option>
        <option value="FR">France</option>
        <option value="ES">Spain</option>
	<select>
	<p>Currency</p>
	<select id="currency">
        <option value="USD">US Dollar</option>
        <option value="CAD">Canadian Dollar</option>
        <option value="GBP">Pound</option>
        <option value="EUR">Euro</option>
  	</select>
 	<p>Routing Number</p>
  	<input type="text" id="routing-number" name="test">
  	<p>Account Number</p>
  	<input type="text" id="account-number">
 	<p>Account Holder Name</p>
 	<input type="text" id="account-name">
 	<p>Account Holder Type</p>
 	<select id="account-holder-type">
  		<option value="individual">Individual</option>
    	<option value="company">Company</option>
  	</select>
  	<p id="bank-errors"></p>
  	<p>By registering your account, you agree to <a href="https://stripe.com/us/connect-account/legal">the Stripe Connected Account Agreement.</a></p>
  	<button id="submit">Submit</button>
	<script type="text/javascript">
		Stripe.setPublishableKey( '{{ pub_key }}' );

		var form = document.getElementById('submit');
		form.addEventListener('click', function(event) {
			event.preventDefault();

			var personal_errors = checkPersonalInput();
			if (personal_errors.length > 0) {
				personal_errors = personal_errors.join('');
				console.log(personal_errors);
				$('#personal-info-errors').html(
					'<b>Missing the following fields:</b>' + 
					personal_errors);
				return;
			}

			Stripe.bankAccount.createToken({
				country: $('#country').val(),
				currency: $('#currency').val(),
				routing_number: $('#routing-number').val(),
				account_number: $('#account-number').val(),
  				account_holder_name: $('#account-name').val(),
  				account_holder_type: $('#account_holder_type').val()
			}, function(status, response) {
				if (response.error) {
					$('#bank-errors').text(response.error.message);
				} else {
					$('#bank-token').val(response.id);
					$('#bank-form').submit();
				}
			});
		});

		function checkPersonalInput() {
			var errors = [];
			var elements = document.forms["bank-form"].getElementsByTagName("input");
			for(var i = 0; i < elements.length; i++) {
				if (elements[i].value == "") {
					errors.push('<p>' + elements[i].alt + '</p>');
				}
			}
			return errors;
		}
	</script>
{% endblock %}